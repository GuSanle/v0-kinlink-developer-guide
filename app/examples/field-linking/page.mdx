import Link from "next/link";
import { ArrowLeft } from "lucide-react";
import { Button } from "@/components/ui/button";
import { CodeBlock } from "@/components/code-block";
import {
  HighlightTabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from "../highlight-tabs";
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "字段联动 - Kinlink开发者",
  description: "学习如何使用字段联动和条件逻辑创建动态表单",
};

const sampleCode = `/**
 * 示例7: 字段联动
 * 功能：根据某个字段的值变化自动控制其他字段的状态
 */
(function () {
  // 表单加载时的初始设置
  kinlink.events.on(kinlink.FormEvents.FORM_LOADED, () => {
    try {
      // 性别字段联动初始化
      updateFieldsByGender(kinlink.formApi.getFieldValue('单选框_0'));
    } catch (error) {
      console.error('字段联动初始化失败:', error);
    }
  });

  // 监听字段变化事件
  kinlink.events.on(kinlink.FormEvents.FIELD_CHANGE, (data) => {
    try {
      const { fieldName, value } = data;

      // 根据性别字段变化联动其他字段
      if (fieldName === '单选框_0') {
        updateFieldsByGender(value);
      }

      // 根据集合场所的选择联动其他信息
      if (fieldName === '下拉菜单') {
        updateByMeetingPlace(value);
      }

      // 联动设置案件编号与案件名称
      if (fieldName === 'Lookup_0' && value) {
        // 假设这里会自动通过Lookup功能填充关联字段
        // 如果没有自动填充，可以手动设置相关值
        console.log('案件编号已更新:', value);
      }
    } catch (error) {
      console.error('字段联动处理失败:', error);
    }
  });

  // 性别联动函数
  function updateFieldsByGender(gender) {
    const form = kinlink.formApi;

    if (gender === '男') {
      // 对于男性，修改标签样式
      form.setFieldLabelStyle('单行文本框_8', {
        color: '#3498db',
      });
      form.setFieldLabelStyle('单行文本框_9', {
        color: '#3498db',
      });
    } else if (gender === '女') {
      // 对于女性，修改标签样式
      form.setFieldLabelStyle('单行文本框_8', {
        color: '#e74c3c',
      });
      form.setFieldLabelStyle('单行文本框_9', {
        color: '#e74c3c',
      });
    }

    // 可以在这里添加其他基于性别的联动逻辑
    console.log('性别联动已处理:', gender);
  }

  // 集合场所联动函数
  function updateByMeetingPlace(place) {
    const form = kinlink.formApi;

    // 根据不同集合场所设置不同信息
    if (place === 'A') {
      form.showInfo('A场所的集合时间为上午9:00');

      // 显示A场所特定字段（如果有）
      // form.showField('A场所注意事项');
    } else if (place === 'B') {
      form.showInfo('B场所的集合时间为上午10:30');

      // 显示B场所特定字段（如果有）
      // form.showField('B场所注意事项');
    }

    console.log('集合场所联动已处理:', place);
  }
})();`;

<div className="container py-6 lg:py-10">
  <div className="flex items-center gap-4 mb-8">
    <Link href="/examples">
      <Button variant="outline" size="icon">
        <ArrowLeft className="h-4 w-4" />
      </Button>
    </Link>
    # 字段联动
  </div>

  <div className="prose prose-blue dark:prose-invert max-w-none">
本示例演示如何使用字段联动和条件逻辑创建动态表单。您将学习如何基于用户输入显示/隐藏字段、自动计算值，以及根据表单状态应用不同的验证规则。

    <HighlightTabs defaultValue="overview">
      <TabsList className="mb-4">
        <TabsTrigger value="overview">概述</TabsTrigger>
        <TabsTrigger value="code">代码</TabsTrigger>
        <TabsTrigger value="usage">使用方法</TabsTrigger>
      </TabsList>

      <TabsContent value="overview" className="space-y-4">
## 您将学到什么
* 如何基于下拉选择显示和隐藏字段
* 如何基于数量和价格输入计算总计
* 如何根据表单状态应用不同的验证规则
* 如何创建响应式和交互式表单体验

## 主要特性
* **动态字段可见性：** 基于用户选择显示或隐藏字段
* **自动计算：** 自动计算总计并应用折扣
* **条件验证：** 根据表单状态应用不同的验证规则
* **视觉反馈：** 为用户提供清晰的视觉反馈

## 使用场景
* 带有产品选项和定价的订单表单
* 基于用户类型有不同路径的注册表单
* 带有条件问题的调查表单
* 带有动态部分的申请表单
      </TabsContent>

      <TabsContent value="code">
## 完整示例
此代码演示了产品订单表单中的字段联动。它基于产品类型显示/隐藏字段，计算总计，并应用折扣。

        <CodeBlock
          code={sampleCode}
          language="javascript"
          filename="field-linking-example.js"
        />

### 表单结构
此示例假设表单具有以下字段：

        <CodeBlock
          code={`{
    "revision": "901",
    "properties": {
        "レコード番号": {
            "type": "RECORD_NUMBER",
            "code": "レコード番号",
            "label": "レコード番号",
            "noLabel": false
        },
        "表格": {
            "type": "SUBTABLE",
            "code": "表格",
            "noLabel": false,
            "label": "表格",
            "fields": {
                "单行文本框_4": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "单行文本框_4",
                    "label": "单行文本框",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "多选_1": {
                    "type": "MULTI_SELECT",
                    "code": "多选_1",
                    "label": "多选",
                    "noLabel": false,
                    "required": false,
                    "options": {
                        "sample1": {
                            "label": "sample1",
                            "index": "0"
                        },
                        "sample4": {
                            "label": "sample4",
                            "index": "3"
                        },
                        "sample3": {
                            "label": "sample3",
                            "index": "2"
                        },
                        "sample2": {
                            "label": "sample2",
                            "index": "1"
                        }
                    },
                    "defaultValue": []
                }
            }
        },
        "更新者": {
            "type": "MODIFIER",
            "code": "更新者",
            "label": "更新者",
            "noLabel": false
        },
        "ステータス": {
            "type": "STATUS",
            "code": "ステータス",
            "label": "ステータス",
            "enabled": true
        },
        "カテゴリー": {
            "type": "CATEGORY",
            "code": "カテゴリー",
            "label": "カテゴリー",
            "enabled": false
        },
        "附件_0": {
            "type": "FILE",
            "code": "附件_0",
            "label": "パスポート写真",
            "noLabel": false,
            "required": false,
            "thumbnailSize": "150"
        },
        "单行文本框_0": {
            "type": "SINGLE_LINE_TEXT",
            "code": "单行文本框_0",
            "label": "案件名",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "单行文本框_10": {
            "type": "SINGLE_LINE_TEXT",
            "code": "单行文本框_10",
            "label": "会社名",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "单行文本框_11": {
            "type": "SINGLE_LINE_TEXT",
            "code": "单行文本框_11",
            "label": "パスポート番号／身分証番号",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "日期_1": {
            "type": "DATE",
            "code": "日期_1",
            "label": "生年月日",
            "noLabel": false,
            "required": false,
            "unique": false,
            "defaultValue": "",
            "defaultNowValue": false
        },
        "日期_2": {
            "type": "DATE",
            "code": "日期_2",
            "label": "パスポート有効期限",
            "noLabel": false,
            "required": false,
            "unique": false,
            "defaultValue": "",
            "defaultNowValue": false
        },
        "作業者": {
            "type": "STATUS_ASSIGNEE",
            "code": "作業者",
            "label": "作業者",
            "enabled": true
        },
        "作成者": {
            "type": "CREATOR",
            "code": "作成者",
            "label": "作成者",
            "noLabel": false
        },
        "单行文本框_9": {
            "type": "SINGLE_LINE_TEXT",
            "code": "单行文本框_9",
            "label": "ローマ字名",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "下拉菜单": {
            "type": "DROP_DOWN",
            "code": "下拉菜单",
            "label": "集合場所",
            "noLabel": false,
            "required": false,
            "options": {
                "x x x 3q": {
                    "label": "x x x 3q",
                    "index": "28"
                },
                "65 x x x2 q": {
                    "label": "65 x x x2 q",
                    "index": "26"
                },
                "x x12 x q": {
                    "label": "x x12 x q",
                    "index": "38"
                },
                "x x x q7678": {
                    "label": "x x x q7678",
                    "index": "50"
                },
                "x 2x x q54": {
                    "label": "x 2x x q54",
                    "index": "18"
                },
                "x x x q123": {
                    "label": "x x x q123",
                    "index": "12"
                },
                "x x x q65": {
                    "label": "x x x q65",
                    "index": "48"
                },
                "x x x5433 q": {
                    "label": "x x x5433 q",
                    "index": "42"
                },
                "7 x x x q": {
                    "label": "7 x x x q",
                    "index": "8"
                },
                "x 8x x q": {
                    "label": "x 8x x q",
                    "index": "24"
                },
                "x 4x x q": {
                    "label": "x 4x x q",
                    "index": "20"
                },
                "x x x 87q": {
                    "label": "x x x 87q",
                    "index": "46"
                },
                "x x 33x q": {
                    "label": "x x 33x q",
                    "index": "40"
                },
                "x x x 67q": {
                    "label": "x x x 67q",
                    "index": "33"
                },
                "65 x x x q9": {
                    "label": "65 x x x q9",
                    "index": "47"
                },
                "x x x q17": {
                    "label": "x x x q17",
                    "index": "16"
                },
                "x x x q16": {
                    "label": "x x x q16",
                    "index": "15"
                },
                "x x x q15": {
                    "label": "x x x q15",
                    "index": "14"
                },
                "x x x q14": {
                    "label": "x x x q14",
                    "index": "13"
                },
                "x x43 x q": {
                    "label": "x x43 x q",
                    "index": "43"
                },
                "12 x x x q": {
                    "label": "12 x x x q",
                    "index": "11"
                },
                "x x x333 q x x x q": {
                    "label": "x x x333 q x x x q",
                    "index": "41"
                },
                "A": {
                    "label": "A",
                    "index": "0"
                },
                "8 x x x q": {
                    "label": "8 x x x q",
                    "index": "9"
                },
                "x11 x x q243": {
                    "label": "x11 x x q243",
                    "index": "37"
                },
                "B": {
                    "label": "B",
                    "index": "1"
                },
                "x 5x x q": {
                    "label": "x 5x x q",
                    "index": "21"
                },
                "x x x q4": {
                    "label": "x x x q4",
                    "index": "5"
                },
                "x x x q3": {
                    "label": "x x x q3",
                    "index": "4"
                },
                "x x x45 q": {
                    "label": "x x x45 q",
                    "index": "49"
                },
                "x x x q2": {
                    "label": "x x x q2",
                    "index": "3"
                },
                "x7 x x q": {
                    "label": "x7 x x q",
                    "index": "23"
                },
                "x x x q1": {
                    "label": "x x x q1",
                    "index": "2"
                },
                "x x x q6": {
                    "label": "x x x q6",
                    "index": "7"
                },
                "x x x q5": {
                    "label": "x x x q5",
                    "index": "6"
                },
                "54 x x x q6": {
                    "label": "54 x x x q6",
                    "index": "32"
                },
                "x x x 8q54": {
                    "label": "x x x 8q54",
                    "index": "34"
                },
                "x x x q x x x4 q x x x q": {
                    "label": "x x x q x x x4 q x x x q",
                    "index": "29"
                },
                "x x x132 q x x x q": {
                    "label": "x x x132 q x x x q",
                    "index": "39"
                },
                "x 3x x q": {
                    "label": "x 3x x q",
                    "index": "19"
                },
                "x x x 65q": {
                    "label": "x x x 65q",
                    "index": "44"
                },
                "x x x q9": {
                    "label": "x x x q9",
                    "index": "10"
                },
                "x x x q76": {
                    "label": "x x x q76",
                    "index": "45"
                },
                "x 9x x q": {
                    "label": "x 9x x q",
                    "index": "25"
                },
                "x x x 10q76": {
                    "label": "x x x 10q76",
                    "index": "36"
                },
                "x 6x x q": {
                    "label": "x 6x x q",
                    "index": "22"
                },
                "x 1x x q5": {
                    "label": "x 1x x q5",
                    "index": "17"
                },
                "x x x5 q544": {
                    "label": "x x x5 q544",
                    "index": "30"
                },
                "x x x q x x x q x x x q": {
                    "label": "x x x q x x x q x x x q",
                    "index": "27"
                },
                "x x x 9q65": {
                    "label": "x x x 9q65",
                    "index": "35"
                },
                "x x 56x q": {
                    "label": "x x 56x q",
                    "index": "31"
                }
            },
            "defaultValue": ""
        },
        "文字列__1行__0": {
            "type": "SINGLE_LINE_TEXT",
            "code": "文字列__1行__0",
            "label": "漢字姓",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "文字列__1行__1": {
            "type": "SINGLE_LINE_TEXT",
            "code": "文字列__1行__1",
            "label": "漢字名",
            "noLabel": false,
            "required": true,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "单行文本框_8": {
            "type": "SINGLE_LINE_TEXT",
            "code": "单行文本框_8",
            "label": "ローマ字姓",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "更新日時": {
            "type": "UPDATED_TIME",
            "code": "更新日時",
            "label": "更新日時",
            "noLabel": false
        },
        "单选框_0": {
            "type": "RADIO_BUTTON",
            "code": "单选框_0",
            "label": "性別",
            "noLabel": false,
            "required": true,
            "options": {
                "女": {
                    "label": "女",
                    "index": "1"
                },
                "男": {
                    "label": "男",
                    "index": "0"
                }
            },
            "defaultValue": "男",
            "align": "HORIZONTAL"
        },
        "文字列__1行__2": {
            "type": "SINGLE_LINE_TEXT",
            "code": "文字列__1行__2",
            "label": "携帯電話",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "文字列__1行__3": {
            "type": "SINGLE_LINE_TEXT",
            "code": "文字列__1行__3",
            "label": "Eメールアドレス",
            "noLabel": false,
            "required": false,
            "minLength": "",
            "maxLength": "",
            "expression": "",
            "hideExpression": false,
            "unique": false,
            "defaultValue": ""
        },
        "选择用户": {
            "type": "USER_SELECT",
            "code": "选择用户",
            "label": "担当者",
            "noLabel": false,
            "required": false,
            "entities": [],
            "defaultValue": []
        },
        "表格_13": {
            "type": "SUBTABLE",
            "code": "表格_13",
            "noLabel": false,
            "label": "同行者",
            "fields": {
                "文字列__1行__4": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "文字列__1行__4",
                    "label": "漢字姓",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "单行文本框_3": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "单行文本框_3",
                    "label": "パスポート番号／身分証番号",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "附件": {
                    "type": "FILE",
                    "code": "附件",
                    "label": "パスポート写真",
                    "noLabel": false,
                    "required": true,
                    "thumbnailSize": "150"
                },
                "单行文本框": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "单行文本框",
                    "label": "ローマ字姓",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "文字列__1行__5": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "文字列__1行__5",
                    "label": "携帯電話",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "单行文本框_1": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "单行文本框_1",
                    "label": "ローマ字名",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "单行文本框_2": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "单行文本框_2",
                    "label": "会社名",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "文字列__1行__6": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "文字列__1行__6",
                    "label": "Eメールアドレス",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "日期": {
                    "type": "DATE",
                    "code": "日期",
                    "label": "パスポート有効期限",
                    "noLabel": false,
                    "required": false,
                    "unique": false,
                    "defaultValue": "",
                    "defaultNowValue": false
                },
                "文字列__1行_": {
                    "type": "SINGLE_LINE_TEXT",
                    "code": "文字列__1行_",
                    "label": "漢字名",
                    "noLabel": false,
                    "required": false,
                    "minLength": "",
                    "maxLength": "",
                    "expression": "",
                    "hideExpression": false,
                    "unique": false,
                    "defaultValue": ""
                },
                "单选框": {
                    "type": "RADIO_BUTTON",
                    "code": "单选框",
                    "label": "性別",
                    "noLabel": false,
                    "required": true,
                    "options": {
                        "女": {
                            "label": "女",
                            "index": "1"
                        },
                        "男": {
                            "label": "男",
                            "index": "0"
                        }
                    },
                    "defaultValue": "男",
                    "align": "HORIZONTAL"
                },
                "复选框_0": {
                    "type": "CHECK_BOX",
                    "code": "复选框_0",
                    "label": "复选框",
                    "noLabel": false,
                    "required": false,
                    "options": {
                        "sa1": {
                            "label": "sa1",
                            "index": "0"
                        },
                        "sa2": {
                            "label": "sa2",
                            "index": "1"
                        }
                    },
                    "defaultValue": [],
                    "align": "HORIZONTAL"
                }
            }
        },
        "Lookup_0": {
            "type": "SINGLE_LINE_TEXT",
            "code": "Lookup_0",
            "label": "案件编号",
            "noLabel": false,
            "required": false,
            "lookup": null
        },
        "选择用户_1": {
            "type": "USER_SELECT",
            "code": "选择用户_1",
            "label": "副担当者",
            "noLabel": false,
            "required": false,
            "entities": [],
            "defaultValue": []
        },
        "多选_0": {
            "type": "MULTI_SELECT",
            "code": "多选_0",
            "label": "このツアーはどこでお知りになりましたか",
            "noLabel": false,
            "required": false,
            "options": {
                "Wechat JTB日本語サイト": {
                    "label": "Wechat JTB日本語サイト",
                    "index": "0"
                },
                "その他JTB上海からのご案内": {
                    "label": "その他JTB上海からのご案内",
                    "index": "1"
                },
                "らくらくプレス": {
                    "label": "らくらくプレス",
                    "index": "2"
                },
                "Whenever": {
                    "label": "Whenever",
                    "index": "3"
                },
                "ジャピオン": {
                    "label": "ジャピオン",
                    "index": "4"
                }
            },
            "defaultValue": []
        },
        "作成日時": {
            "type": "CREATED_TIME",
            "code": "作成日時",
            "label": "作成日時",
            "noLabel": false
        },
        "选择组织": {
            "type": "ORGANIZATION_SELECT",
            "code": "选择组织",
            "label": "担当部署",
            "noLabel": false,
            "required": false,
            "entities": [],
            "defaultValue": []
        }
    }
}`}
          language="html"
          filename="form-structure.html"
        />
      </TabsContent>

      <TabsContent value="usage">
## 如何使用此示例

### 步骤1：创建您的表单
首先，在您的Kinlink仪表板中创建一个具有表单结构中所示字段的表单。确保使用与示例代码中相同的字段名称。

### 步骤2：添加JavaScript代码
从"代码"选项卡复制JavaScript代码，并将其粘贴到Kinlink表单的自定义JavaScript部分。

### 步骤3：测试您的表单
预览您的表单并测试以下功能：
* 在标准和高级之间更改产品类型
* 输入不同的数量和价格以查看总计更新
* 为高级产品选择折扣选项
* 使用有效和无效数据提交表单

### 自定义选项
您可以通过多种方式自定义此示例：
* 添加更多具有不同字段和选项的产品类型
* 实现不同的折扣率或计算方法
* 为特定字段添加更多验证规则
* 自定义成功和错误消息

### 最佳实践
* **清晰的用户反馈：**{" "}
  当字段出现或消失时，始终提供清晰的反馈
* **一致的验证：** 确保验证规则一致且有意义
* **性能：** 注意可能影响性能的复杂计算
* **无障碍：** 确保在字段显示或隐藏时表单仍然可访问
      </TabsContent>
    </HighlightTabs>

    <div className="mt-8 flex flex-col sm:flex-row gap-4">
      <Link href="/examples">
        <Button variant="outline">
          <ArrowLeft className="mr-2 h-4 w-4" />
          返回示例
        </Button>
      </Link>
      <Link href="/docs/api-reference/form-api">
        <Button variant="secondary">查看表单API文档</Button>
      </Link>
    </div>
  </div>
</div>
