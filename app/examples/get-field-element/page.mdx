import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { CodeBlock } from "@/components/code-block";
import Link from "next/link";
import { ArrowLeft } from "lucide-react";
import { Button } from "@/components/ui/button";

<div className="container max-w-4xl py-6 lg:py-10 mdx-content">
  <div className="flex items-center gap-4 mb-8">
    <Link href="/examples" className="flex items-center">
      <Button variant="outline" size="icon" className="h-10 w-10 flex items-center justify-center">
        <ArrowLeft className="h-4 w-4" />
      </Button>
    </Link>
    <h1 className="text-3xl font-bold tracking-tight m-0 p-0 leading-[1.2] flex items-center">è·å–å­—æ®µå…ƒç´ ç¤ºä¾‹</h1>
  </div>

  <div className="space-y-8 px-8">
    <div>
      <h2>å­—æ®µå…ƒç´ æ“ä½œæ¦‚è§ˆ</h2>
      
      > æ·±åº¦è®¿é—®è¡¨å•å­—æ®µDOMå…ƒç´ ï¼Œå®ç°é«˜çº§è‡ªå®šä¹‰å’Œç²¾ç»†æ§åˆ¶

      æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨**kinlink API**è·å–è¡¨å•å­—æ®µçš„**DOMå…ƒç´ **ï¼Œå¹¶å¯¹å…¶è¿›è¡Œ**ç›´æ¥æ“ä½œ**ã€‚é€šè¿‡è·å–å­—æ®µå…ƒç´ ï¼Œæ‚¨å¯ä»¥å®ç°æ›´é«˜çº§çš„è‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¦‚æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ã€ä¿®æ”¹å†…éƒ¨ç»“æ„æˆ–é›†æˆç¬¬ä¸‰æ–¹æ’ä»¶ã€‚

      ### å­—æ®µå…ƒç´ æ“ä½œæ ¸å¿ƒåŠŸèƒ½
      - ğŸ¯ **ç²¾ç¡®è·å–**ï¼šé€šè¿‡å­—æ®µä»£ç å‡†ç¡®å®šä½DOMå…ƒç´ 
      - ğŸ”§ **ç›´æ¥æ“ä½œ**ï¼šå¯¹å­—æ®µè¿›è¡Œåº•å±‚DOMæ“ä½œ
      - ğŸ¨ **æ·±åº¦å®šåˆ¶**ï¼šå®ç°APIæ— æ³•è¦†ç›–çš„é«˜çº§å®šåˆ¶
      - ğŸ“ **äº‹ä»¶ç»‘å®š**ï¼šä¸ºå­—æ®µæ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨
      - ğŸ” **æ¡ä»¶éšè—**ï¼šåŸºäºå¤æ‚é€»è¾‘æ§åˆ¶å­—æ®µæ˜¾ç¤º
      - ğŸ”— **ç¬¬ä¸‰æ–¹é›†æˆ**ï¼šä¸å…¶ä»–JavaScriptåº“æ— ç¼é›†æˆ
    </div>

    <div>
      <h2>å…³é”®åŠŸèƒ½</h2>
      <ul>
        <li>è·å–æŒ‡å®šå­—æ®µçš„DOMå…ƒç´ </li>
        <li>å¯¹å­—æ®µå…ƒç´ è¿›è¡Œç›´æ¥æ“ä½œ</li>
        <li>å®ç°æ¡ä»¶æ€§å­—æ®µéšè—</li>
        <li>æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶å’Œäº¤äº’</li>
      </ul>
    </div>

    <div>
      <h2>ä»£ç ç¤ºä¾‹</h2>
      <div className="-ml-8">
        <Tabs defaultValue="javascript">
          <TabsList className="ml-8">
            <TabsTrigger value="javascript">JavaScript</TabsTrigger>
          </TabsList>
          <TabsContent value="javascript" className="mt-4">
            <CodeBlock 
              code={`/**
 * ç¤ºä¾‹11: è·å–å­—æ®µå…ƒç´ ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶éšè—
 * åŠŸèƒ½ï¼šé€šè¿‡APIè·å–å­—æ®µDOMå…ƒç´ å¹¶è¿›è¡Œæ“ä½œ
 */
(function () {
  kinlink.events.on(kinlink.FormEvents.FORM_LOADED, () => {
    try {
      // è·å–å„ç§å­—æ®µçš„DOMå…ƒç´ 
      const nameField = kinlink.formApi.getFieldElement('æ–‡å­—åˆ—__1è¡Œ__0');
      const emailField = kinlink.formApi.getFieldElement('æ–‡å­—åˆ—__1è¡Œ__3');
      const phoneField = kinlink.formApi.getFieldElement('æ–‡å­—åˆ—__1è¡Œ__2');
      const companyField = kinlink.formApi.getFieldElement('å•è¡Œæ–‡æœ¬æ¡†_10');

      console.log('è·å–åˆ°çš„å­—æ®µå…ƒç´ :');
      console.log('å§“åå­—æ®µ:', nameField);
      console.log('é‚®ç®±å­—æ®µ:', emailField);
      console.log('ç”µè¯å­—æ®µ:', phoneField);
      console.log('å…¬å¸å­—æ®µ:', companyField);

      // åˆ›å»ºæ“ä½œæ¼”ç¤ºé¢æ¿
      const demoPanel = createDemoPanel();
      
      // ç¤ºä¾‹1: ä¸ºå­—æ®µæ·»åŠ è‡ªå®šä¹‰æ ·å¼å’Œäº‹ä»¶
      if (nameField) {
        enhanceNameField(nameField);
      }

      // ç¤ºä¾‹2: æ¡ä»¶æ€§æ˜¾ç¤º/éšè—å­—æ®µ
      setupConditionalVisibility();

      // ç¤ºä¾‹3: ä¸ºå­—æ®µæ·»åŠ è‡ªå®šä¹‰éªŒè¯æç¤º
      if (emailField) {
        addCustomValidationToEmail(emailField);
      }

      // ç¤ºä¾‹4: å­—æ®µç„¦ç‚¹ç®¡ç†
      setupFocusManagement([nameField, emailField, phoneField]);

      // æ·»åŠ æ¼”ç¤ºé¢æ¿åˆ°è¡¨å•
      const formElement = document.querySelector('.ant-form') || document.body;
      formElement.insertBefore(demoPanel, formElement.firstChild);

    } catch (error) {
      console.error('è·å–å­—æ®µå…ƒç´ æ“ä½œå¤±è´¥:', error);
    }
  });

  // åˆ›å»ºæ¼”ç¤ºæ“ä½œé¢æ¿
  function createDemoPanel() {
    const panel = document.createElement('div');
    panel.style.cssText = \`
      margin: 10px 0;
      padding: 20px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    \`;

    panel.innerHTML = \`
      <h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; font-weight: bold;">
        å­—æ®µå…ƒç´ æ“ä½œæ¼”ç¤º
      </h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
        <button id="highlightFields" style="padding: 10px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
          ğŸ¯ é«˜äº®æ˜¾ç¤ºæ‰€æœ‰å­—æ®µ
        </button>
        <button id="toggleCompanyField" style="padding: 10px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer;">
          ğŸ‘ï¸ åˆ‡æ¢å…¬å¸å­—æ®µæ˜¾ç¤º
        </button>
        <button id="focusFirstField" style="padding: 10px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer;">
          ğŸ“ èšç„¦åˆ°ç¬¬ä¸€ä¸ªå­—æ®µ
        </button>
        <button id="showFieldInfo" style="padding: 10px; background: #f39c12; color: white; border: none; border-radius: 6px; cursor: pointer;">
          â„¹ï¸ æ˜¾ç¤ºå­—æ®µä¿¡æ¯
        </button>
      </div>
    \`;

    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    panel.addEventListener('click', handlePanelClick);

    return panel;
  }

  // å¤„ç†æ¼”ç¤ºé¢æ¿æŒ‰é’®ç‚¹å‡»
  function handlePanelClick(event) {
    const target = event.target;
    
    if (target.id === 'highlightFields') {
      highlightAllFields();
    } else if (target.id === 'toggleCompanyField') {
      toggleCompanyFieldVisibility();
    } else if (target.id === 'focusFirstField') {
      focusToFirstField();
    } else if (target.id === 'showFieldInfo') {
      showAllFieldsInfo();
    }
  }

  // é«˜äº®æ˜¾ç¤ºæ‰€æœ‰å­—æ®µ
  function highlightAllFields() {
    const fieldCodes = ['æ–‡å­—åˆ—__1è¡Œ__0', 'æ–‡å­—åˆ—__1è¡Œ__1', 'æ–‡å­—åˆ—__1è¡Œ__2', 'æ–‡å­—åˆ—__1è¡Œ__3', 'å•è¡Œæ–‡æœ¬æ¡†_10'];
    
    fieldCodes.forEach((fieldCode, index) => {
      const element = kinlink.formApi.getFieldElement(fieldCode);
      if (element) {
        // æ·»åŠ é«˜äº®æ•ˆæœ
        element.style.transition = 'all 0.3s ease';
        element.style.background = \`hsl(\${index * 60}, 70%, 95%)\`;
        element.style.border = \`2px solid hsl(\${index * 60}, 70%, 60%)\`;
        element.style.borderRadius = '8px';
        element.style.padding = '10px';
        
        // 3ç§’åç§»é™¤é«˜äº®
        setTimeout(() => {
          element.style.background = '';
          element.style.border = '';
          element.style.borderRadius = '';
          element.style.padding = '';
        }, 3000);
      }
    });

    kinlink.formApi.showMessage('info', 'æ‰€æœ‰å­—æ®µå·²é«˜äº®æ˜¾ç¤ºï¼Œ3ç§’åæ¢å¤æ­£å¸¸', 3);
  }

  // åˆ‡æ¢å…¬å¸å­—æ®µæ˜¾ç¤ºçŠ¶æ€
  let companyFieldHidden = false;
  function toggleCompanyFieldVisibility() {
    const companyElement = kinlink.formApi.getFieldElement('å•è¡Œæ–‡æœ¬æ¡†_10');
    
    if (companyElement) {
      if (companyFieldHidden) {
        companyElement.style.display = '';
        kinlink.formApi.showMessage('success', 'å…¬å¸å­—æ®µå·²æ˜¾ç¤º', 2);
      } else {
        companyElement.style.display = 'none';
        kinlink.formApi.showMessage('warning', 'å…¬å¸å­—æ®µå·²éšè—', 2);
      }
      companyFieldHidden = !companyFieldHidden;
    }
  }

  // èšç„¦åˆ°ç¬¬ä¸€ä¸ªå­—æ®µ
  function focusToFirstField() {
    const firstField = kinlink.formApi.getFieldElement('æ–‡å­—åˆ—__1è¡Œ__0');
    
    if (firstField) {
      const input = firstField.querySelector('input, textarea, select');
      if (input) {
        input.focus();
        input.style.boxShadow = '0 0 10px #3498db';
        setTimeout(() => {
          input.style.boxShadow = '';
        }, 2000);
        kinlink.formApi.showMessage('info', 'å·²èšç„¦åˆ°ç¬¬ä¸€ä¸ªå­—æ®µ', 2);
      }
    }
  }

  // æ˜¾ç¤ºæ‰€æœ‰å­—æ®µä¿¡æ¯
  function showAllFieldsInfo() {
    const fieldCodes = ['æ–‡å­—åˆ—__1è¡Œ__0', 'æ–‡å­—åˆ—__1è¡Œ__1', 'æ–‡å­—åˆ—__1è¡Œ__2', 'æ–‡å­—åˆ—__1è¡Œ__3', 'å•è¡Œæ–‡æœ¬æ¡†_10'];
    let info = 'å­—æ®µä¿¡æ¯:\\n\\n';
    
    fieldCodes.forEach(fieldCode => {
      const element = kinlink.formApi.getFieldElement(fieldCode);
      if (element) {
        const rect = element.getBoundingClientRect();
        info += \`å­—æ®µä»£ç : \${fieldCode}\\n\`;
        info += \`ä½ç½®: \${Math.round(rect.left)}, \${Math.round(rect.top)}\\n\`;
        info += \`å¤§å°: \${Math.round(rect.width)} Ã— \${Math.round(rect.height)}\\n\\n\`;
      }
    });
    
    alert(info);
  }

  // å¢å¼ºå§“åå­—æ®µ
  function enhanceNameField(element) {
    if (!element) return;
    
    const input = element.querySelector('input');
    if (input) {
      // æ·»åŠ è¾“å…¥æç¤º
      input.placeholder = 'è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å';
      
      // æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬
      input.addEventListener('input', function() {
        if (this.value.length > 10) {
          this.style.borderColor = '#e74c3c';
          kinlink.formApi.showMessage('warning', 'å§“åé•¿åº¦ä¸åº”è¶…è¿‡10ä¸ªå­—ç¬¦', 2);
        } else {
          this.style.borderColor = '';
        }
      });
    }
  }

  // è®¾ç½®æ¡ä»¶æ€§å¯è§æ€§
  function setupConditionalVisibility() {
    // ç›‘å¬å­—æ®µå€¼å˜åŒ–
    kinlink.events.on(kinlink.FormEvents.FIELD_VALUE_CHANGED, (data) => {
      const { fieldCode, value } = data;
      
      // å¦‚æœé‚®ç®±å­—æ®µæœ‰å€¼ï¼Œæ˜¾ç¤ºå…¬å¸å­—æ®µ
      if (fieldCode === 'æ–‡å­—åˆ—__1è¡Œ__3') {
        const companyElement = kinlink.formApi.getFieldElement('å•è¡Œæ–‡æœ¬æ¡†_10');
        if (companyElement) {
          if (value && value.includes('@')) {
            companyElement.style.display = '';
            kinlink.formApi.showMessage('info', 'æ£€æµ‹åˆ°é‚®ç®±ï¼Œå·²æ˜¾ç¤ºå…¬å¸å­—æ®µ', 2);
          } else {
            companyElement.style.display = 'none';
          }
        }
      }
    });
  }

  // ä¸ºé‚®ç®±å­—æ®µæ·»åŠ è‡ªå®šä¹‰éªŒè¯æç¤º
  function addCustomValidationToEmail(element) {
    if (!element) return;
    
    const input = element.querySelector('input');
    if (input) {
      input.addEventListener('blur', function() {
        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
        if (this.value && !emailRegex.test(this.value)) {
          this.style.borderColor = '#e74c3c';
          kinlink.formApi.showMessage('error', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 3);
        } else if (this.value) {
          this.style.borderColor = '#27ae60';
        }
      });
    }
  }

  // è®¾ç½®ç„¦ç‚¹ç®¡ç†
  function setupFocusManagement(elements) {
    elements.forEach((element, index) => {
      if (!element) return;
      
      const input = element.querySelector('input, textarea, select');
      if (input) {
        input.addEventListener('keydown', function(e) {
          // Enteré”®è·³åˆ°ä¸‹ä¸€ä¸ªå­—æ®µ
          if (e.key === 'Enter' && index < elements.length - 1) {
            e.preventDefault();
            const nextElement = elements[index + 1];
            if (nextElement) {
              const nextInput = nextElement.querySelector('input, textarea, select');
              if (nextInput) {
                nextInput.focus();
              }
            }
          }
        });
      }
    });
  }
})();`} 
              language="javascript" 
            />
          </TabsContent>
        </Tabs>
      </div>
    </div>

    <div>
      <h2>ä½¿ç”¨è¯´æ˜</h2>
      <div>
        è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œåªéœ€å°†ä»£ç å¤åˆ¶åˆ°æ‚¨çš„kinlinkè‡ªå®šä¹‰JavaScriptä¸­ã€‚é€šè¿‡è·å–å­—æ®µå…ƒç´ ï¼Œæ‚¨å¯ä»¥å®ç°æ›´é«˜çº§çš„å­—æ®µæ“ä½œå’Œè‡ªå®šä¹‰åŠŸèƒ½ã€‚
      </div>
      <div>
        å®Œæ•´ä»£ç è¯·ä¸‹è½½æŸ¥çœ‹ï¼š
        <a
          href="/samplesCodes/11-è·å–å­—æ®µå…ƒç´ ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶éšè—.js"
          className="text-primary hover:underline ml-1"
          download="11-è·å–å­—æ®µå…ƒç´ ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶éšè—.js"
        >
          11-è·å–å­—æ®µå…ƒç´ ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶éšè—.js
        </a>
      </div>
      <div className="p-4 border rounded-md bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700">
        <h3 className="font-semibold text-yellow-800 dark:text-yellow-200">æ³¨æ„äº‹é¡¹</h3>
        <div className="text-yellow-800 dark:text-yellow-300">
          ç›´æ¥æ“ä½œDOMå…ƒç´ éœ€è¦è°¨æ…ï¼Œç¡®ä¿ä¸ä¼šç ´åè¡¨å•çš„åŸæœ‰åŠŸèƒ½ã€‚å»ºè®®åœ¨ä¿®æ”¹å…ƒç´ å‰å…ˆå¤‡ä»½åŸå§‹çŠ¶æ€ï¼Œä»¥ä¾¿å¿…è¦æ—¶æ¢å¤ã€‚
        </div>
      </div>
    </div>

    <div>
      <h2>APIå‚è€ƒ</h2>
      <div>æ­¤ç¤ºä¾‹ä½¿ç”¨äº†ä»¥ä¸‹kinlink APIï¼š</div>
      <ul>
        <li>
          <code>kinlink.events.on(eventName, callback)</code> -
          æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
        </li>
        <li>
          <code>kinlink.FormEvents.FORM_LOADED</code> - è¡¨å•åŠ è½½å®Œæˆäº‹ä»¶
        </li>
        <li>
          <code>kinlink.FormEvents.FIELD_VALUE_CHANGED</code> - å­—æ®µå€¼å˜åŒ–äº‹ä»¶
        </li>
        <li>
          <code>kinlink.formApi.getFieldElement(fieldCode)</code> -
          è·å–æŒ‡å®šå­—æ®µçš„DOMå…ƒç´ 
        </li>
        <li>
          <code>kinlink.formApi.showMessage(type, message, duration)</code> -
          æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        </li>
      </ul>
    </div>
  </div>
</div> 