import { Metadata } from "next";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { CodeBlock } from "@/components/code-block";
import Link from "next/link";
import { ArrowLeft } from "lucide-react";
import { Button } from "@/components/ui/button";

export const metadata: Metadata = {
  title: "获取字段元素并条件隐藏 - Kinlink开发者",
  description: "学习如何获取字段元素，并使用条件隐藏功能",
};

const sampleCode = `/**
 * 示例：在指定字段后面插入按钮，实现条件隐藏/显示字段 并且实现视觉隐藏和真实隐藏
 * 视觉隐藏为被隐藏的内容最终还是会被提交，而真实隐藏为被隐藏的内容不会被提交
 */
(function () {
  kinlink.events.on(kinlink.FormEvents.FORM_LOADED, () => {
    try {
      // ========== 携帯電話字段后面插入按钮，控制会社名隐藏/显示 ==========
      const targetFieldCode = '文字列__1行__2'; // 携帯電話
      const controlFieldCode = '单行文本框_10'; // 会社名

      const input = document.querySelector(\`[id$='\${targetFieldCode}']\`);
      if (input) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = '隐藏/显示会社名';
        btn.style.marginLeft = '8px';
        input.parentNode.insertBefore(btn, input.nextSibling);
        let isHidden = false;
        btn.onclick = function () {
          if (isHidden) {
            kinlink.formApi.showField(controlFieldCode);
            btn.textContent = '隐藏会社名';
          } else {
            kinlink.formApi.hideField(controlFieldCode);
            btn.textContent = '显示会社名';
          }
          isHidden = !isHidden;
        };
      }

      // ========== Eメールアドレス字段后面插入按钮，视觉隐藏/显示身分証番号 ==========
      const emailFieldCode = '文字列__1行__3'; // Eメールアドレス
      const idFieldCode = '单行文本框_11'; // パスポート番号／身分証番号
      const emailInput = document.querySelector(\`[id$='\${emailFieldCode}']\`);
      if (emailInput) {
        const btn2 = document.createElement('button');
        btn2.type = 'button';
        btn2.textContent = '视觉隐藏/显示身分証番号';
        btn2.style.marginLeft = '8px';
        emailInput.parentNode.insertBefore(btn2, emailInput.nextSibling);
        let isVisuallyHidden = false;
        btn2.onclick = function () {
          if (isVisuallyHidden) {
            kinlink.formApi.showField(idFieldCode);
            btn2.textContent = '视觉隐藏身分証番号';
          } else {
            kinlink.formApi.visuallyHideField(idFieldCode);
            btn2.textContent = '显示身分証番号';
          }
          isVisuallyHidden = !isVisuallyHidden;
        };
      }
    } catch (error) {
      console.error('插入按钮并控制字段显示失败:', error);
    }
  });
})();
`;

<div className="container py-6 lg:py-10">
  <div className="flex items-center gap-4 mb-8">
    <Link href="/examples">
      <Button variant="outline" size="icon">
        <ArrowLeft className="h-4 w-4" />
      </Button>
    </Link>
    # 获取字段元素并条件隐藏
  </div>

  <div className="my-8 space-y-6">
    <div className="space-y-4">
## 功能概述
此示例演示如何获取表单字段元素，并在其旁边添加控制按钮，实现对其他字段的条件隐藏和显示功能。示例展示了两种隐藏方式：真实隐藏（hideField）和视觉隐藏（visuallyHideField）的区别和使用场景。
    </div>

    <div className="space-y-4">
## 关键概念
* **真实隐藏 (hideField)**：完全隐藏字段，其值也不会被提交
* **视觉隐藏 (visuallyHideField)**：字段不可见，但其值仍会被提交
* **DOM操作**：获取字段元素并在其旁边添加交互元素
* **条件切换**：根据用户交互切换字段的显示状态
    </div>

    <div className="space-y-4">
## 代码示例
      <Tabs defaultValue="javascript">
        <TabsList>
          <TabsTrigger value="javascript">JavaScript</TabsTrigger>
        </TabsList>
        <TabsContent value="javascript">
          <CodeBlock code={sampleCode} language="javascript" />
        </TabsContent>
      </Tabs>
    </div>

    <div className="space-y-4">
## 实现细节
1.  使用`document.querySelector`获取字段输入元素
2.  创建按钮元素并设置其样式和文本
3.  将按钮插入到字段元素旁边
4.  设置按钮点击事件处理程序
5.  在点击事件中切换目标字段的显示状态
6.  更新按钮文本以反映当前状态
    </div>

    <div className="space-y-4">
## 使用说明
将代码复制到您的Kinlink自定义JavaScript中，根据您的表单字段修改字段代码。确保使用正确的字段ID以获取正确的元素。
      <div className="p-4 border rounded-md bg-yellow-50 border-yellow-200">
        <h3 className="font-semibold text-yellow-800">注意事项</h3>
        <p className="text-yellow-800">
          使用<code>document.querySelector</code>
          时需要小心，确保选择器足够具体以获取正确的元素。通过
          <code>[id$='fieldCode']</code>
          可以选择ID以特定字段代码结尾的元素，这在Kinlink生成的动态ID中非常有用。
        </p>
      </div>
    </div>

    <div className="space-y-4">
## 选择器技巧
在Kinlink表单中获取字段元素时，可以使用以下选择器技巧：
* `[id$='fieldCode']` - 选择ID以特定字段代码结尾的元素
* `[data-field-code='fieldCode']` - 如果字段有data属性，可以使用此选择器
* `.ant-form-item[data-field='fieldCode']` - 选择特定字段的表单项
* `document.querySelector(\`[id$='\${"字段代码"}']\`)` - 结合模板字符串动态构建选择器
    </div>

    <div className="space-y-4">
## API参考
此示例使用了以下Kinlink API：
* `kinlink.formApi.hideField(fieldCode)` - 完全隐藏字段（值不提交）
* `kinlink.formApi.visuallyHideField(fieldCode)` - 视觉隐藏字段（值仍提交）
* `kinlink.formApi.showField(fieldCode)` - 显示字段
    </div>

    <div className="space-y-4">
## 应用场景
* 在表单字段旁添加辅助按钮或控件
* 创建更复杂的用户交互模式
* 根据用户的即时操作控制表单布局
* 实现表单字段的依赖关系
    </div>
  </div>
</div>
