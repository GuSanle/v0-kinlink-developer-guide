import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { CodeBlock } from "@/components/code-block";
import Link from "next/link";
import { ArrowLeft } from "lucide-react";
import { Button } from "@/components/ui/button";

<Link href="/examples">
  <Button variant="outline" size="icon">
    <ArrowLeft className="h-4 w-4" />
  </Button>
</Link>

# 表单验证规则定制示例

  <div className="my-8 space-y-6">
    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">验证功能实现概览</h2>
      > 构建智能表单验证系统，实现邮箱、手机号、日期等字段的实时验证

      此示例演示如何为表单字段添加**自定义验证规则**。您将学习如何实现**邮箱格式验证**、**手机号验证**、**日期有效性检查**等常见验证场景，并提供**实时反馈**给用户。

      ### 验证系统核心特性
      - 📧 **邮箱格式验证**：标准邮箱地址格式检查
      - 📱 **手机号码验证**：国际化手机号格式支持
      - 📅 **日期有效性验证**：证件过期检查和预警
      - 🎯 **实时验证反馈**：输入即时验证，提升用户体验
      - 🔧 **自定义错误消息**：友好的错误提示信息
      - ⚡ **手动触发验证**：支持表单整体验证检查
    </div>

    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">完整验证实现代码</h2>
      > 包含邮箱、手机、日期验证的完整实现，支持多种验证场景

      <Tabs defaultValue="javascript">
        <TabsList>
          <TabsTrigger value="javascript">JavaScript</TabsTrigger>
        </TabsList>
        <TabsContent value="javascript">
          <CodeBlock 
            code={`/**
 * 示例6: 自定义验证规则
 * 功能：为表单字段添加自定义验证规则
 */
(function () {
  kinlink.events.on(kinlink.FormEvents.FORM_LOADED, () => {
    try {
      const form = kinlink.formApi;

      // 为邮箱字段添加格式验证
      form.addFieldValidator('文字列__1行__3', (value) => {
        if (!value) return; // 非必填，空值不验证

        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;
        if (!emailRegex.test(value)) {
          return '请输入有效的邮箱地址';
        }
        return undefined; // 验证通过
      });

      // 为手机号字段添加格式验证
      form.addFieldValidator('文字列__1行__2', (value) => {
        if (!value) return; // 非必填，空值不验证

        // 简单的手机号验证规则（不限制国家/地区前缀）
        const phoneRegex = /^\\+?[0-9]{7,15}$/;
        if (!phoneRegex.test(value)) {
          return '请输入有效的手机号码（7-15位数字，可以包含+号前缀）';
        }
        return undefined; // 验证通过
      });

      // 为护照有效期添加未过期验证
      form.addFieldValidator('日期_2', (value) => {
        if (!value) return; // 非必填，空值不验证

        const today = new Date();
        const expiryDate = new Date(value);

        // 确保日期有效
        if (isNaN(expiryDate.getTime())) {
          return '请输入有效的日期';
        }

        // 检查是否已过期
        if (expiryDate < today) {
          return '护照/证件已过期，请提供有效期内的证件';
        }

        // 检查是否即将过期（小于6个月）
        const sixMonthsLater = new Date();
        sixMonthsLater.setMonth(today.getMonth() + 6);

        if (expiryDate < sixMonthsLater) {
          // 这是警告而非错误，需手动显示
          form.showWarning(
            '您的护照/证件将在6个月内过期，可能影响某些国家/地区的入境要求',
          );
        }

        return undefined; // 验证通过
      });

      // 添加手动触发验证的按钮
      const validateButton = document.createElement('button');
      validateButton.textContent = '验证表单';
      validateButton.style.margin = '10px 0';
      validateButton.style.padding = '5px 10px';

      validateButton.addEventListener('click', () => {
        const result = form.validateForm();
        console.log('验证结果:', result);

        if (result.isValid) {
          form.showSuccess('表单验证通过');
        } else {
          form.showError('表单验证失败，请检查输入');
        }
      });

      // 添加按钮到表单
      const formElement = document.querySelector('.ant-form') || document.body;
      formElement.insertBefore(validateButton, formElement.firstChild);
    } catch (error) {
      console.error('添加自定义验证规则失败:', error);
    }
  });
})();`} 
            language="javascript" 
          />
        </TabsContent>
      </Tabs>
    </div>

    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">集成部署说明</h2>
      > 将验证规则应用到您的表单项目中的操作指南

      **部署步骤：**
      1. 将上述代码复制到您的**kinlink自定义JavaScript**中
      2. 根据您的表单字段修改相应的**字段代码**
      3. 调整验证规则以符合您的业务需求
      4. 保存并测试验证功能

      **字段代码适配：** 此示例假设表单包含邮箱（`'文字列__1行__3'`）、手机号（`'文字列__1行__2'`）和护照有效期（`'日期_2'`）字段。

      <div className="p-4 border rounded-md bg-blue-50 border-blue-200">
        <h3 className="font-semibold text-blue-800">💡 验证器配置提示</h3>
        <div className="text-blue-800">
          您可以为任何字段添加**自定义验证规则**。验证函数返回**错误消息字符串**表示验证失败，返回**undefined**表示验证通过。
        </div>
      </div>
    </div>

    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">验证API参考文档</h2>
      > 表单验证相关的kinlink API方法详细说明

      **验证规则管理API：**
      - **`kinlink.formApi.addFieldValidator(fieldCode, validatorFunction)`** - 为指定字段添加自定义验证规则
      - **`kinlink.formApi.validateForm()`** - 手动触发整个表单的验证
      - **`kinlink.formApi.removeFieldValidator(fieldCode)`** - 移除字段的验证规则

      **消息提示API：**
      - **`kinlink.formApi.showSuccess(message)`** - 显示成功消息
      - **`kinlink.formApi.showError(message)`** - 显示错误消息
      - **`kinlink.formApi.showWarning(message)`** - 显示警告消息

      **验证结果对象结构：**
      ```javascript
      {
        isValid: boolean,    // 整体验证是否通过
        errors: {           // 验证错误详情
          fieldCode: "错误消息"
        }
      }
      ```
    </div>

    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">验证规则应用场景</h2>
      > 自定义验证在不同业务表单中的实际应用

      **用户信息表单：**
      - 👤 **用户注册**：邮箱唯一性、密码强度验证
      - 📞 **联系信息**：手机号格式、地址完整性验证
      - 🆔 **身份验证**：证件号码格式、有效期验证

      **业务流程表单：**
      - 📋 **申请表单**：必填项检查、业务规则验证
      - 💰 **财务表单**：金额范围、预算限制验证
      - 📅 **预约表单**：时间可用性、冲突检查验证

      **数据采集表单：**
      - 📊 **调查问卷**：选项逻辑、答案一致性验证
      - 📝 **反馈表单**：内容长度、敏感词过滤验证
      - 🔍 **搜索表单**：关键词格式、参数有效性验证
    </div>

    <div className="space-y-4">
      <h2 className="text-2xl font-bold tracking-tight">验证开发最佳实践</h2>
      > 构建用户友好且高效的验证系统的经验总结

      **用户体验优化：**
      - 💬 **友好错误消息**：提供清晰、具体的错误提示信息
      - ⚡ **实时验证反馈**：输入时即时验证，减少提交时的错误
      - 🎯 **渐进式验证**：先检查格式，再检查业务规则

      **验证逻辑设计：**
      - 🔧 **灵活的验证规则**：对于非必填字段，空值时不进行验证
      - 📊 **正则表达式应用**：使用标准正则进行格式验证
      - ⚠️ **警告与错误区分**：为即将过期的数据提供警告而非错误

      **性能与维护：**
      - 🛡️ **异常处理**：验证函数需要处理各种异常情况
      - 📝 **代码可读性**：使用清晰的变量名和注释
      - 🔄 **可扩展设计**：便于添加新的验证规则和修改现有规则
    </div>
  </div>
